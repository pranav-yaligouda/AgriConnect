import{m as te,a8 as re,i as se,r as m,j as e,B as l,C as T,k as N,A as ie,T as o,af as ne,P as z,z as E,X as d,l as v,N as le,O as oe,Q as ce,U as A,V as i,W as de,Y as ue,D as F,E as B,H as L,K as M,f,G as u,h as x,F as _,v as R,w as H,M as n,s as me,J as ge}from"./vendor-BfjQx7as.js";import{I as xe}from"./dashboard-D54Ge2h1.js";import{u as he,i as D,y as j,E as U,D as O,e as G,g as je,K as be}from"./auth-p7_ywuS4.js";import{c as K}from"./marketplace-azDLA9kT.js";const Ce=()=>{const s=te(),P=re(s.breakpoints.down("sm")),X=se(),[h,C]=m.useState([]),[q,Q]=m.useState(!0),[S,J]=m.useState(""),[V,b]=m.useState(!1),[r,c]=m.useState(null),[p,pe]=m.useState(!1),[Y,y]=m.useState(!1),[k,w]=m.useState(null),{t}=he();m.useEffect(()=>{Z()},[]);const Z=async()=>{try{if(!localStorage.getItem("token")){X("/login");return}const g=await D.get("/products/farmer/my-products");C(g.data),Q(!1)}catch(a){console.error("Error fetching products:",a),J("Failed to load products"),j.error("Failed to load products"),Q(!1)}},W=a=>{c(a),b(!0)},I=a=>{w(a),y(!0)},ee=async()=>{if(k)try{await D.delete(`/products/${k}`),C(h.filter(a=>a._id!==k)),j.success("Product deleted successfully")}catch(a){console.error("Error deleting product:",a),j.error("Failed to delete product")}finally{y(!1),w(null)}},ae=async()=>{if(r)try{const a={name:r.name,description:r.description,price:Number(r.price),category:r.category,availableQuantity:Number(r.availableQuantity),...typeof r.minimumOrderQuantity=="number"&&!isNaN(r.minimumOrderQuantity)?{minimumOrderQuantity:r.minimumOrderQuantity}:typeof r.minimumOrderQuantity=="string"&&r.minimumOrderQuantity!==void 0&&r.minimumOrderQuantity!==null&&r.minimumOrderQuantity.trim()!==""&&!isNaN(Number(r.minimumOrderQuantity))?{minimumOrderQuantity:Number(r.minimumOrderQuantity)}:{},unit:r.unit,images:(r.images||[]).map(String),isOrganic:!!r.isOrganic,harvestDate:r.harvestDate,location:{district:r.location.district,state:r.location.state}},g=await D.patch(`/products/${r._id}`,a);C(h.map($=>$._id===r._id?g.data:$)),b(!1),j.success("Product updated successfully")}catch(a){console.error("Error updating product:",a),j.error("Failed to update product")}};return q?e.jsx(l,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",children:e.jsx(T,{})}):S?e.jsx(N,{sx:K,children:e.jsx(ie,{severity:"error",sx:{mt:3},children:S})}):e.jsxs(N,{maxWidth:P?"sm":"lg",sx:K,children:[e.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:e.jsx(o,{variant:P?"h5":"h4",component:"h1",children:t("manageProducts.manageProducts")})}),P?e.jsx(l,{children:h.length===0?e.jsx(o,{align:"center",color:"textSecondary",sx:{mt:4},children:t("manageProducts.noProducts")||"No products found."}):e.jsx(l,{children:h.map((a,g)=>e.jsx(ne,{direction:"up",in:!0,mountOnEnter:!0,unmountOnExit:!0,timeout:400+g*50,children:e.jsxs(z,{elevation:4,sx:{mb:3,borderRadius:4,p:2,display:"flex",flexDirection:"column",background:`linear-gradient(120deg, ${s.palette.background.paper} 85%, ${s.palette.primary.light} 100%)`,boxShadow:s.shadows[6],position:"relative",transition:"box-shadow 0.3s","&:hover":{boxShadow:s.shadows[12]}},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{src:a.images[0]||"/product-placeholder.jpg",variant:"rounded",sx:{width:72,height:72,mr:2,border:`2px solid ${s.palette.primary.main}`},alt:a.name}),e.jsxs(l,{flex:1,children:[e.jsx(o,{variant:"h6",fontWeight:"700",sx:{letterSpacing:.2},children:a.name}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:[a.location.district,", ",a.location.state]}),a.isOrganic&&e.jsx(d,{label:t("manageProducts.organic"),size:"small",color:"success",sx:{mt:.5,fontWeight:600}})]}),e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsx(v,{"aria-label":"edit",color:"primary",size:"large",onClick:()=>W(a),sx:{mb:.5},children:e.jsx(U,{fontSize:"medium"})}),e.jsx(v,{"aria-label":"delete",color:"error",size:"large",onClick:()=>I(a._id),children:e.jsx(O,{fontSize:"medium"})})]})]}),e.jsxs(l,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:1,justifyContent:"flex-start"},children:[e.jsx(d,{label:`${t("manageProducts.category")}: ${a.category}`,color:"primary",sx:{fontWeight:500}}),e.jsx(d,{label:`${t("manageProducts.price")}: ₹${a.price}/${a.unit}`,sx:{fontWeight:500}}),e.jsx(d,{label:`${t("manageProducts.availableQuantity")}: ${a.availableQuantity} ${a.unit}`,sx:{fontWeight:500}}),e.jsx(d,{label:`${t("manageProducts.status")}: ${a.isAvailable?t("manageProducts.active"):t("manageProducts.inactive")}`,color:a.isAvailable?"success":"error",sx:{fontWeight:500}}),e.jsx(d,{label:`${t("manageProducts.harvestDate")}: ${new Date(a.harvestDate).toLocaleDateString()}`,icon:e.jsx(G,{fontSize:"small"}),sx:{fontWeight:500}}),e.jsx(d,{label:`${t("manageProducts.minimumOrderQuantity")}: ${a.minimumOrderQuantity??t("manageProducts.notSet")}`,sx:{fontWeight:500}})]})]})},a._id))})}):e.jsx(e.Fragment,{children:e.jsx(z,{sx:{backgroundColor:s.palette.background.paper,boxShadow:s.shadows[8],borderRadius:4,overflowX:"auto",transition:"box-shadow 0.3s",mt:2},children:e.jsx(le,{sx:{maxHeight:"70vh",borderRadius:4},children:e.jsxs(oe,{stickyHeader:!0,children:[e.jsx(ce,{sx:{backgroundColor:s.palette.primary.light,"& th":{color:s.palette.primary.contrastText,fontWeight:"bold",position:"sticky",top:0,zIndex:2,background:s.palette.primary.light,borderBottom:`2px solid ${s.palette.primary.main}`}},children:e.jsxs(A,{children:[e.jsx(i,{children:t("manageProducts.product")}),e.jsx(i,{children:t("manageProducts.category")}),e.jsx(i,{align:"right",children:t("manageProducts.price")}),e.jsx(i,{align:"center",children:t("manageProducts.stock")}),e.jsx(i,{children:t("manageProducts.status")}),e.jsx(i,{children:t("manageProducts.harvestDate")}),e.jsx(i,{children:t("manageProducts.minimumOrderQuantity")}),e.jsx(i,{children:t("manageProducts.actions")})]})}),e.jsx(de,{children:h.map((a,g)=>e.jsxs(A,{hover:!0,sx:{backgroundColor:g%2===0?s.palette.action.hover:"inherit",transition:"background 0.2s","&:hover":{backgroundColor:s.palette.action.selected}},children:[e.jsx(i,{children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{src:a.images[0]||"/product-placeholder.jpg",variant:"rounded",sx:{width:56,height:56}}),e.jsxs(l,{children:[e.jsx(o,{variant:"body1",fontWeight:"500",children:a.name}),e.jsxs(o,{variant:"body2",color:"textSecondary",children:[a.location.district,", ",a.location.state]}),a.isOrganic&&e.jsx(d,{label:t("manageProducts.organic"),size:"small",color:"success",sx:{mt:.5}})]})]})}),e.jsx(i,{children:e.jsx(d,{label:a.category,color:"primary",sx:{textTransform:"capitalize"}})}),e.jsx(i,{align:"right",children:e.jsxs(o,{color:"primary",fontWeight:"500",children:["₹",a.price,"/",a.unit]})}),e.jsx(i,{align:"center",children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ue,{variant:"determinate",value:Math.min(a.availableQuantity/100*100,100),sx:{flexGrow:1,height:8,borderRadius:4,"& .MuiLinearProgress-bar":{borderRadius:4,backgroundColor:a.availableQuantity>20?s.palette.success.main:s.palette.warning.main}}}),e.jsxs(o,{children:[a.availableQuantity," ",a.unit]})]})}),e.jsx(i,{children:e.jsx(d,{label:a.isAvailable?t("manageProducts.active"):t("manageProducts.inactive"),color:a.isAvailable?"success":"error",icon:a.isAvailable?e.jsx(je,{}):e.jsx(be,{})})}),e.jsx(i,{children:e.jsx(d,{label:new Date(a.harvestDate).toLocaleDateString(),icon:e.jsx(G,{fontSize:"small"}),variant:"outlined"})}),e.jsx(i,{children:a.minimumOrderQuantity!==null&&a.minimumOrderQuantity!==void 0?e.jsxs(o,{children:[a.minimumOrderQuantity," ",a.unit]}):e.jsx(o,{children:t("manageProducts.notSet")})}),e.jsxs(i,{children:[e.jsx(v,{onClick:()=>W(a),color:"primary","aria-label":t("manageProducts.edit"),children:e.jsx(U,{})}),e.jsx(v,{onClick:()=>I(a._id),color:"error","aria-label":t("manageProducts.delete"),children:e.jsx(O,{})})]})]},a._id))})]})})})}),e.jsxs(F,{open:Y,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(B,{children:t("manageProducts.confirmDelete")}),e.jsx(L,{children:e.jsx(o,{variant:"body1",children:t("manageProducts.confirmDeleteMessage")})}),e.jsxs(M,{children:[e.jsx(f,{onClick:()=>y(!1),color:"primary",variant:"outlined",children:t("manageProducts.cancel")}),e.jsx(f,{onClick:ee,color:"error",variant:"contained",startIcon:e.jsx(O,{}),children:t("manageProducts.confirmDelete")})]})]}),e.jsxs(F,{open:V,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(B,{children:t("manageProducts.editProduct")}),e.jsx(L,{children:r&&e.jsxs(l,{component:"form",sx:{mt:2},children:[e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{label:t("manageProducts.productName"),fullWidth:!0,value:r.name,onChange:a=>c({...r,name:a.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(_,{fullWidth:!0,children:[e.jsx(R,{children:t("manageProducts.category")}),e.jsxs(H,{value:r.category,onChange:a=>c({...r,category:a.target.value}),label:t("manageProducts.category"),children:[e.jsx(n,{value:"vegetables",children:t("manageProducts.vegetables")}),e.jsx(n,{value:"fruits",children:t("manageProducts.fruits")}),e.jsx(n,{value:"grains",children:t("manageProducts.grains")}),e.jsx(n,{value:"dairy",children:t("manageProducts.dairy")}),e.jsx(n,{value:"meat",children:t("manageProducts.meat")}),e.jsx(n,{value:"poultry",children:t("manageProducts.poultry")}),e.jsx(n,{value:"other",children:t("manageProducts.other")})]})]})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{label:t("manageProducts.price"),type:"number",fullWidth:!0,value:r.price,onChange:a=>c({...r,price:Number(a.target.value)})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(_,{fullWidth:!0,children:[e.jsx(R,{children:t("manageProducts.unit")}),e.jsxs(H,{value:r.unit,onChange:a=>c({...r,unit:a.target.value}),label:t("manageProducts.unit"),children:[e.jsx(n,{value:"kg",children:t("manageProducts.kg")}),e.jsx(n,{value:"g",children:t("manageProducts.g")}),e.jsx(n,{value:"lb",children:t("manageProducts.lb")}),e.jsx(n,{value:"piece",children:t("manageProducts.piece")}),e.jsx(n,{value:"dozen",children:t("manageProducts.dozen")}),e.jsx(n,{value:"bunch",children:t("manageProducts.bunch")})]})]})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{label:t("manageProducts.availableQuantity"),type:"number",fullWidth:!0,required:!0,value:r.availableQuantity,onChange:a=>c({...r,availableQuantity:Number(a.target.value)})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{label:t("manageProducts.minimumOrderQuantity"),type:"number",fullWidth:!0,value:r.minimumOrderQuantity??"",onChange:a=>c({...r,minimumOrderQuantity:a.target.value===""?null:Number(a.target.value)}),helperText:t("manageProducts.minimumOrderQuantityHelper")})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{label:t("manageProducts.harvestDate"),type:"date",fullWidth:!0,value:new Date(r.harvestDate).toISOString().split("T")[0],onChange:a=>c({...r,harvestDate:a.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(x,{label:t("manageProducts.description"),multiline:!0,rows:4,fullWidth:!0,value:r.description,onChange:a=>c({...r,description:a.target.value})})})]}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(me,{control:e.jsx(ge,{checked:r.isAvailable,onChange:a=>c({...r,isAvailable:a.target.checked}),color:"success"}),label:r.isAvailable?t("manageProducts.active"):t("manageProducts.inactive")})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(o,{variant:"subtitle2",gutterBottom:!0,children:t("manageProducts.productImages")}),e.jsx(xe,{images:r.images,onImagesChange:a=>c({...r,images:a}),uploading:p})]})]})}),e.jsxs(M,{children:[e.jsx(f,{onClick:()=>b(!1),color:"primary",variant:"outlined",children:t("manageProducts.cancel")}),e.jsx(f,{onClick:ae,color:"primary",variant:"contained",disabled:p,startIcon:p?e.jsx(T,{size:20,color:"inherit"}):void 0,children:p?t("manageProducts.saving")||"Saving...":t("manageProducts.saveChanges")})]})]})]})};export{Ce as default};
//# sourceMappingURL=ManageProducts-CBl050Wg.js.map
