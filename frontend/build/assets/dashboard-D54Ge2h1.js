import{b as M,d as L,e as $,j as e,B as c,f as m,x as Vr,l as Pe,r as d,m as yr,i as vr,C as V,k as J,A as Me,T as i,G as h,z as Se,D as ee,E as re,H as te,h as S,F as Ae,v as Fe,w as ze,M as _,s as Jr,J as Kr,K as ae,P as N,N as Te,O as We,Q as Ne,U as Z,V as p,W as Oe,X as le,Y as Yr,Z as Gr,_ as Xr,$ as Zr,a0 as sr,a1 as et,a2 as Ee,a3 as qe,a4 as rt,a5 as nr,a6 as tt,a7 as at}from"./vendor-BfjQx7as.js";import{i as b,r as U,u as Cr,y as g,V as ir,E as Pr,D as or,a as st,P as nt,L as it}from"./auth-p7_ywuS4.js";const ot=async(r,n,o)=>{try{return(await b.get(`/contact-requests/status/${r}/${n}${o?`?t=${o}`:""}`)).data}catch(x){return console.error("Check existing request failed:",x),{exists:!1}}};async function lt(r,n){var o,x,a;try{return(await b.post("/contact-requests/create",{productId:r,requestedQuantity:n})).data}catch(P){if(((o=P.response)==null?void 0:o.status)===409)return{message:"Request already exists",existingRequestId:P.response.data.existingRequestId};throw((x=P.response)==null?void 0:x.status)===429?new Error(((a=P.response.data)==null?void 0:a.message)||"You have reached your daily contact request limit. Please try again tomorrow."):P}}async function Le(){return(await b.get("/contact-requests/my")).data}const Sr=r=>b.put(`/contact-requests/${r}/accept`),wr=r=>b.put(`/contact-requests/${r}/reject`);async function dt(r){try{return(await b.post("/users/register",r)).data}catch(n){throw O(n)}}async function ct(r){try{return(await b.post("/users/generate-username",{name:r})).data}catch(n){throw O(n)}}async function $e(){try{return(await b.get("/users/profile")).data}catch(r){throw O(r)}}async function Ue(r){try{return(await b.patch("/users/profile",r)).data}catch(n){throw O(n)}}async function Ir(){try{await b.delete("/users/profile")}catch(r){throw O(r)}}async function Qe(r){var n;try{return(await b.get("/products/farmer/my-products",{signal:r==null?void 0:r.signal})).data}catch(o){if(o.name==="CanceledError")return[];if(((n=o.response)==null?void 0:n.status)===403)return console.log("Access denied to farmer products"),[];throw O(o)}}async function ut(){try{const r=await b.get("/products/categories");return Array.isArray(r.data)?r.data:[]}catch(r){throw O(r)}}async function ht(r){try{const n=await b.get("/products",{params:r});return n.data&&Array.isArray(n.data.products)?n.data:{products:Array.isArray(n.data)?n.data:[],total:Array.isArray(n.data)?n.data.length:0,page:1,pageCount:1}}catch(n){throw O(n)}}async function kr(r){try{return(await b.post("/products",r)).data}catch(n){throw O(n)}}async function Dr(r){try{await b.delete(`/products/${r}`)}catch(n){throw O(n)}}async function Rr(){try{return(await b.get("/users/dashboard")).data}catch(r){throw O(r)}}async function _r(r,n){return b.post(`/contact-requests/${r}/user-confirm`,n)}async function Ar(r,n){return b.post(`/contact-requests/${r}/farmer-confirm`,n)}async function xt({username:r,password:n,deviceFingerprint:o}){return b.post("/admin/login",{username:r,password:n,deviceFingerprint:o})}async function mt(){return b.get("/users/admin/users")}async function pt(){return b.get("/users/admin/products")}async function ft(){return b.get("/users/admin/logs")}async function jt(){return b.get("/users/admin/settings")}function O(r){var n,o;return r&&r.response?{message:((n=r.response.data)==null?void 0:n.message)||"An error occurred",details:(o=r.response.data)==null?void 0:o.details,status:r.response.status}:r&&r.request?{message:"No response received from server",status:0}:{message:(r==null?void 0:r.message)||"An error occurred",status:0}}const Gt=Object.freeze(Object.defineProperty({__proto__:null,acceptContactRequest:Sr,addProduct:kr,adminLogin:xt,checkExistingContactRequest:ot,confirmContactRequestAsFarmer:Ar,confirmContactRequestAsUser:_r,createContactRequest:lt,deleteProduct:Dr,deleteProfile:Ir,fetchAdminLogs:ft,fetchAdminProducts:pt,fetchAdminSettings:jt,fetchAdminUsers:mt,fetchCategories:ut,fetchDashboardData:Rr,fetchMyContactRequests:Le,fetchMyProducts:Qe,fetchProducts:ht,fetchUserProfile:$e,generateUsername:ct,registerUser:dt,rejectContactRequest:wr,updateProfile:Ue},Symbol.toStringTag,{value:"Module"}));var de={},lr;function gt(){if(lr)return de;lr=1;var r=M();Object.defineProperty(de,"__esModule",{value:!0}),de.default=void 0;var n=r(U()),o=L();return de.default=(0,n.default)((0,o.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),de}var bt=gt();const yt=$(bt),vt=({images:r,onImagesChange:n,uploading:o})=>{const x=a=>{const P=a.target.files;if(!P||P.length===0)return;const E=Array.from(P).map(T=>new Promise((D,A)=>{const W=new FileReader;W.onload=()=>D(W.result),W.onerror=A,W.readAsDataURL(T)}));Promise.all(E).then(T=>{n([...r,...T])})};return e.jsxs(c,{sx:{mt:2},children:[e.jsxs(m,{variant:"outlined",component:"label",disabled:o,children:["Upload Images",e.jsx("input",{type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:x})]}),e.jsx(Vr,{direction:"row",spacing:2,sx:{mt:2,overflowX:"auto"},children:r.map((a,P)=>e.jsxs(c,{sx:{position:"relative"},children:[e.jsx(c,{component:"img",src:a,sx:{width:100,height:100,objectFit:"cover",borderRadius:1,border:"1px solid",borderColor:"divider"}}),e.jsx(Pe,{onClick:()=>{const E=[...r];E.splice(P,1),n(E)},sx:{position:"absolute",top:4,right:4,bgcolor:"background.paper",color:"error.main"},size:"small",children:e.jsx(yt,{fontSize:"small"})})]},a))})]})};var ce={},dr;function Ct(){if(dr)return ce;dr=1;var r=M();Object.defineProperty(ce,"__esModule",{value:!0}),ce.default=void 0;var n=r(U()),o=L();return ce.default=(0,n.default)((0,o.jsx)("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard"),ce}var Pt=Ct();const St=$(Pt);var ue={},cr;function wt(){if(cr)return ue;cr=1;var r=M();Object.defineProperty(ue,"__esModule",{value:!0}),ue.default=void 0;var n=r(U()),o=L();return ue.default=(0,n.default)((0,o.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),ue}var It=wt();const kt=$(It);var he={},ur;function Dt(){if(ur)return he;ur=1;var r=M();Object.defineProperty(he,"__esModule",{value:!0}),he.default=void 0;var n=r(U()),o=L();return he.default=(0,n.default)((0,o.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory"),he}var Rt=Dt();const hr=$(Rt);var xe={},xr;function _t(){if(xr)return xe;xr=1;var r=M();Object.defineProperty(xe,"__esModule",{value:!0}),xe.default=void 0;var n=r(U()),o=L();return xe.default=(0,n.default)([(0,o.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,o.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),xe}var At=_t();const Ft=$(At);var me={},mr;function zt(){if(mr)return me;mr=1;var r=M();Object.defineProperty(me,"__esModule",{value:!0}),me.default=void 0;var n=r(U()),o=L();return me.default=(0,n.default)((0,o.jsx)("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m13.5-9 1.96 2.5H17V9.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"LocalShipping"),me}var Tt=zt();const Wt=$(Tt);var pe={},pr;function Nt(){if(pr)return pe;pr=1;var r=M();Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=void 0;var n=r(U()),o=L();return pe.default=(0,n.default)((0,o.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),pe}var Ot=Nt();const fr=$(Ot);var fe={},jr;function Et(){if(jr)return fe;jr=1;var r=M();Object.defineProperty(fe,"__esModule",{value:!0}),fe.default=void 0;var n=r(U()),o=L();return fe.default=(0,n.default)((0,o.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),fe}var qt=Et();const Mt=$(qt);var je={},gr;function Lt(){if(gr)return je;gr=1;var r=M();Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var n=r(U()),o=L();return je.default=(0,n.default)((0,o.jsx)("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"}),"CalendarToday"),je}var $t=Lt();const Ut=$($t);function Be(r){switch(r){case"farmer":return"/images/farmerProfilePlaceholder.png";case"vendor":return"/images/vendorProfilePlaceholder.png";default:return"/images/userProfilePlaceholder.png"}}function Qt(r){if(!r)return Be();const n=r.profileImage;return n&&typeof n=="object"&&"data"in n&&"contentType"in n&&n.data&&n.contentType?`data:${n.contentType};base64,${n.data}`:typeof n=="string"&&n.length>0&&(n.startsWith("data:image/")||!n.includes("farmerProfilePlaceholder.png")&&!n.includes("vendorProfilePlaceholder.png")&&!n.includes("userProfilePlaceholder.png"))?n:Be(r.role)}const Bt=()=>{var be,H;const[r,n]=d.useState(0),o=yr(),x=vr(),{t:a}=Cr(),[P,E]=d.useState(0),[T,D]=d.useState(!1),[A,W]=d.useState(null),[R,B]=d.useState([]),[se,He]=d.useState(!1),[K,we]=d.useState([]),[f,ne]=d.useState(null),[ie,F]=d.useState(!0),[q,Ie]=d.useState(""),[ge,Q]=d.useState(!1),[l,k]=d.useState({name:"",description:"",price:"",category:"",stock:"",unit:"kg",images:[],harvestDate:new Date().toISOString().split("T")[0],isOrganic:!1,location:{district:"",state:""},availableQuantity:""});d.useEffect(()=>{(async()=>{var v;try{const C=await Rr();ne(C.user),B(C.products||[]),we(C.orders||[]),F(!1)}catch(C){let w="Failed to load dashboard data";if(C.response){if(C.response.status===401){localStorage.removeItem("token"),x("/login");return}w=((v=C.response.data)==null?void 0:v.message)||w,console.error("Error fetching dashboard data (response):",C.response)}else C.request?(w="No response received from server. Please check your network or try again later.",console.error("Error fetching dashboard data (request):",C.request)):(w=C.message||w,console.error("Error fetching dashboard data (general):",C));Ie(w),g.error(w),F(!1)}})()},[x]);const oe=async()=>{try{const s=[];if(l.name||s.push(a("dashboard.productName")),l.description||s.push(a("dashboard.description")),l.price||s.push(a("dashboard.price")),l.category||s.push(a("dashboard.category")),l.availableQuantity||s.push(a("dashboard.availableQuantity")),l.unit||s.push(a("dashboard.unit")),l.location.district||s.push(a("dashboard.district")),l.location.state||s.push(a("dashboard.state")),l.images.length===0&&s.push(a("dashboard.images")),s.length>0){g.error(a("dashboard.missingFields",{fields:s.join(", ")}));return}const v={name:l.name,description:l.description,price:parseFloat(l.price),category:l.category,availableQuantity:parseFloat(l.availableQuantity),unit:l.unit,images:l.images,harvestDate:l.harvestDate,isOrganic:l.isOrganic,location:{district:l.location.district,state:l.location.state}};await Ve(v)}catch(s){console.error("Error adding product:",s),g.error(a("dashboard.productAddFail"))}},Ve=async s=>{var v,C;try{const w=await kr(s);B([...R,w]),Q(!1),k({name:"",description:"",price:"",category:"",stock:"",unit:"kg",images:[],harvestDate:new Date().toISOString().split("T")[0],isOrganic:!1,location:{district:"",state:""},availableQuantity:""}),g.success(a("dashboard.productAddedSuccess"))}catch(w){console.error("Error adding product:",w),g.error("Failed to add product: "+(((C=(v=w.response)==null?void 0:v.data)==null?void 0:C.message)||w.message))}};if(ie)return e.jsx(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",children:e.jsx(V,{})});if(q)return e.jsx(J,{children:e.jsx(Me,{severity:"error",children:q})});if(!f)return null;const Je=()=>e.jsxs(h,{container:!0,spacing:3,children:[e.jsxs(h,{item:!0,xs:12,md:4,children:[e.jsxs(N,{sx:{p:2,backgroundColor:o.palette.background.paper,borderLeft:`4px solid ${o.palette.primary.main}`,boxShadow:o.shadows[2]},children:[e.jsxs(i,{variant:"h6",gutterBottom:!0,sx:{color:o.palette.primary.main,display:"flex",alignItems:"center",gap:1},children:[e.jsx(St,{fontSize:"small"}),a("dashboard.quickActions")]}),e.jsx(m,{variant:"contained",color:"primary",startIcon:e.jsx(kt,{}),onClick:()=>Q(!0),fullWidth:!0,sx:{mb:2,py:1.5,transition:"all 0.3s","&:hover":{transform:"translateY(-2px)",boxShadow:o.shadows[4]}},children:a("dashboard.addNewProduct")}),e.jsx(m,{variant:"outlined",color:"primary",startIcon:e.jsx(hr,{}),onClick:()=>x("/my-products"),fullWidth:!0,sx:{py:1.5,transition:"all 0.3s","&:hover":{backgroundColor:o.palette.primary.light,borderColor:o.palette.primary.dark}},children:a("dashboard.manageProducts")})]}),e.jsxs(N,{sx:{mt:2,p:2,backgroundColor:o.palette.success.light,color:o.palette.success.contrastText},children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:a("dashboard.totalInventoryValue")}),e.jsxs(i,{variant:"h5",children:["₹",R.reduce((s,v)=>s+v.price*v.availableQuantity,0).toLocaleString()]})]})]}),e.jsx(h,{item:!0,xs:12,md:8,children:e.jsxs(N,{sx:{p:2,backgroundColor:o.palette.background.paper,boxShadow:o.shadows[2]},children:[e.jsx(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsxs(i,{variant:"h6",sx:{color:o.palette.primary.main,fontWeight:700},children:[e.jsx(Ft,{fontSize:"small",sx:{mr:1}}),a("dashboard.recentlyAddedProducts")]})}),e.jsxs(c,{sx:{width:"100%",overflowX:{xs:"auto",sm:"visible"}},children:[e.jsx(Te,{sx:{minWidth:{xs:400,sm:600},width:"100%"},children:e.jsxs(We,{size:"small",children:[e.jsx(Ne,{sx:{backgroundColor:o.palette.primary.light,"& th":{color:o.palette.primary.contrastText,fontWeight:"bold",px:{xs:1,sm:2},py:{xs:1,sm:2},fontSize:{xs:"0.9rem",sm:"1rem"}}},children:e.jsxs(Z,{children:[e.jsx(p,{children:a("dashboard.product")}),e.jsx(p,{children:a("dashboard.category")}),e.jsx(p,{align:"right",children:a("dashboard.price")}),e.jsx(p,{align:"right",children:a("dashboard.stock")}),e.jsx(p,{children:a("dashboard.harvestDate")})]})}),e.jsx(Oe,{children:R.slice(0,5).map(s=>e.jsxs(Z,{hover:!0,sx:{"&:last-child td":{border:0},cursor:"pointer","&:hover":{backgroundColor:o.palette.action.hover}},onClick:()=>x("/my-products"),children:[e.jsx(p,{sx:{px:{xs:1,sm:2},py:{xs:1,sm:2}},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",minWidth:0},children:[e.jsx(Se,{src:s.images[0]||"/product-placeholder.jpg",variant:"rounded",sx:{width:{xs:36,sm:56},height:{xs:36,sm:56},mr:1,boxShadow:o.shadows[2],backgroundColor:o.palette.grey[200]},imgProps:{onError:v=>{v.currentTarget.src="/product-placeholder.jpg"}},children:e.jsx(hr,{fontSize:"medium"})}),e.jsxs(c,{minWidth:0,children:[e.jsx(i,{variant:"body2",noWrap:!0,sx:{fontWeight:500},children:s.name}),s.isOrganic&&e.jsx(le,{label:a("dashboard.organic"),size:"small",color:"success",sx:{mt:.5}})]})]})}),e.jsx(p,{sx:{px:{xs:1,sm:2},py:{xs:1,sm:2}},children:e.jsx(le,{label:s.category,color:"primary",variant:"filled",sx:{textTransform:"capitalize",fontSize:{xs:"0.8rem",sm:"1rem"}}})}),e.jsx(p,{align:"right",sx:{px:{xs:1,sm:2},py:{xs:1,sm:2}},children:e.jsxs(i,{variant:"body2",color:"primary",fontWeight:"500",children:["₹",s.price,"/",s.unit]})}),e.jsx(p,{align:"right",sx:{px:{xs:1,sm:2},py:{xs:1,sm:2}},children:e.jsxs(c,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:[e.jsx(c,{sx:{width:{xs:36,sm:60},mr:1},children:e.jsx(Yr,{variant:"determinate",value:Math.min(s.availableQuantity/100*100,100),sx:{height:8,borderRadius:4,backgroundColor:o.palette.grey[200],"& .MuiLinearProgress-bar":{borderRadius:4,backgroundColor:s.availableQuantity>20?o.palette.success.main:o.palette.warning.main}}})}),e.jsxs(i,{variant:"caption",children:[s.availableQuantity," ",s.unit]})]})}),e.jsx(p,{sx:{px:{xs:1,sm:2},py:{xs:1,sm:2}},children:e.jsx(le,{label:new Date(s.harvestDate).toLocaleDateString(),variant:"outlined",color:"secondary",icon:e.jsx(Ut,{fontSize:"small",sx:{color:"inherit"}}),sx:{fontSize:{xs:"0.8rem",sm:"1rem"}}})})]},s._id))})]})}),R.length>5&&e.jsx(c,{mt:2,display:"flex",justifyContent:"flex-end",children:e.jsx(m,{variant:"outlined",color:"primary",size:"small",onClick:()=>x("/my-products"),sx:{borderRadius:2,fontWeight:500},children:a("dashboard.viewAllProducts")})})]})]})})]}),ke=()=>e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,md:4,children:e.jsxs(N,{sx:{p:2},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:a("dashboard.quickActions")}),e.jsx(m,{variant:"contained",startIcon:e.jsx(fr,{}),onClick:()=>x("/marketplace"),fullWidth:!0,sx:{mb:2},children:a("dashboard.browseProducts")}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(Wt,{}),onClick:()=>x("/bulk-orders"),fullWidth:!0,children:a("dashboard.bulkOrders")})]})}),e.jsx(h,{item:!0,xs:12,md:8,children:e.jsxs(N,{sx:{p:2},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:a("dashboard.recentBulkOrders")}),e.jsx(Te,{children:e.jsxs(We,{children:[e.jsx(Ne,{children:e.jsxs(Z,{children:[e.jsx(p,{children:a("dashboard.orderId")}),e.jsx(p,{children:a("dashboard.farmer")}),e.jsx(p,{children:a("dashboard.amount")}),e.jsx(p,{children:a("dashboard.status")}),e.jsx(p,{children:a("dashboard.actions")})]})}),e.jsx(Oe,{children:K.slice(0,5).map(s=>e.jsxs(Z,{children:[e.jsxs(p,{children:["#",s._id.slice(-6)]}),e.jsx(p,{children:s.buyer.name}),e.jsxs(p,{children:["₹",s.totalAmount]}),e.jsx(p,{children:e.jsx(le,{label:s.status,color:s.status==="completed"?"success":s.status==="pending"?"warning":"default"})}),e.jsx(p,{children:e.jsx(Pe,{size:"small",onClick:()=>x(`/order/${s._id}`),children:e.jsx(ir,{})})})]},s._id))})]})})]})}),e.jsx(h,{item:!0,xs:12,children:e.jsxs(N,{sx:{p:2},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:a("dashboard.availableProducts")}),e.jsx(h,{container:!0,spacing:2,children:R.map(s=>e.jsx(h,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Gr,{children:[e.jsxs(Xr,{children:[e.jsx("img",{src:s.images[0]||"/product-placeholder.jpg",alt:s.name,style:{width:"100%",height:200,objectFit:"cover"},onError:v=>{v.currentTarget.src="/product-placeholder.jpg"}}),e.jsx(i,{variant:"h6",sx:{mt:1},children:s.name}),e.jsxs(i,{color:"textSecondary",children:["₹",s.price,"/",s.unit]}),e.jsxs(i,{children:[a("dashboard.available"),": ",s.availableQuantity," ",s.unit]})]}),e.jsxs(Zr,{children:[e.jsx(m,{size:"small",onClick:()=>x(`/products/${s._id}`),children:a("dashboard.viewDetails")}),e.jsx(m,{size:"small",color:"primary",onClick:()=>x(`/bulk-order/${s._id}`),children:a("dashboard.bulkOrder")})]})]})},s._id))})]})})]}),Y=()=>e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,md:4,children:e.jsxs(N,{sx:{p:2},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:a("dashboard.quickActions")}),e.jsx(m,{variant:"contained",startIcon:e.jsx(fr,{}),onClick:()=>x("/marketplace"),fullWidth:!0,sx:{mb:2},children:a("dashboard.browseProducts")}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(Mt,{}),onClick:()=>x("/profile"),fullWidth:!0,children:a("dashboard.viewProfile")})]})}),e.jsx(h,{item:!0,xs:12,md:8,children:e.jsxs(N,{sx:{p:2},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:a("dashboard.orderHistory")}),e.jsx(Te,{children:e.jsxs(We,{children:[e.jsx(Ne,{children:e.jsxs(Z,{children:[e.jsx(p,{children:a("dashboard.orderId")}),e.jsx(p,{children:a("dashboard.date")}),e.jsx(p,{children:a("dashboard.items")}),e.jsx(p,{children:a("dashboard.amount")}),e.jsx(p,{children:a("dashboard.status")}),e.jsx(p,{children:a("dashboard.actions")})]})}),e.jsx(Oe,{children:K.map(s=>e.jsxs(Z,{children:[e.jsxs(p,{children:["#",s._id.slice(-6)]}),e.jsx(p,{children:new Date(s.date).toLocaleDateString()}),e.jsx(p,{children:s.items.map(v=>`${v.quantity} x ${v.product}`).join(", ")}),e.jsxs(p,{children:["₹",s.totalAmount]}),e.jsx(p,{children:e.jsx(le,{label:s.status,color:s.status==="completed"?"success":s.status==="pending"?"warning":"default"})}),e.jsx(p,{children:e.jsx(Pe,{size:"small",onClick:()=>x(`/order/${s._id}`),children:e.jsx(ir,{})})})]},s._id))})]})})]})})]});return ie?e.jsxs(J,{maxWidth:"sm",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh"},children:[e.jsx(V,{sx:{mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",children:"Loading your dashboard..."})]}):q?e.jsxs(J,{maxWidth:"sm",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"60vh"},children:[e.jsx(Me,{severity:"error",sx:{mb:2,width:"100%"},children:q}),e.jsx(m,{variant:"contained",color:"primary",onClick:()=>n(s=>s+1),children:"Retry"})]}):e.jsxs(J,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(h,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(h,{item:!0,xs:12,md:4,children:e.jsxs(c,{sx:{p:3,borderRadius:2,bgcolor:"primary.main",color:"white",display:"flex",alignItems:"center",gap:2,boxShadow:2},children:[e.jsx(Se,{src:Qt(f),alt:(f==null?void 0:f.name)||"Profile",sx:{width:56,height:56,bgcolor:"#fff",color:"#222",fontWeight:700,fontSize:28,border:"2px solid #eee"},imgProps:{onError:s=>{s.currentTarget.src=Be(f==null?void 0:f.role)}},children:((be=f==null?void 0:f.name)==null?void 0:be[0])||"?"}),e.jsxs(c,{children:[e.jsx(i,{variant:"h6",fontWeight:700,children:f==null?void 0:f.name}),e.jsx(i,{variant:"body2",children:(H=f==null?void 0:f.role)==null?void 0:H.toUpperCase()}),e.jsx(i,{variant:"body2",sx:{opacity:.85},children:f==null?void 0:f.email})]})]})}),e.jsx(h,{item:!0,xs:12,md:4,children:e.jsxs(c,{sx:{p:3,borderRadius:2,bgcolor:"secondary.main",color:"white",display:"flex",alignItems:"center",gap:2,boxShadow:2},children:[e.jsx(c,{sx:{fontSize:40,mr:2},children:"🛒"}),e.jsxs(c,{children:[e.jsx(i,{variant:"h6",fontWeight:700,children:R.length}),e.jsx(i,{variant:"body2",children:"Products Listed"})]})]})}),e.jsx(h,{item:!0,xs:12,md:4,children:e.jsxs(c,{sx:{p:3,borderRadius:2,bgcolor:"success.main",color:"white",display:"flex",alignItems:"center",gap:2,boxShadow:2},children:[e.jsx(c,{sx:{fontSize:40,mr:2},children:"📦"}),e.jsxs(c,{children:[e.jsx(i,{variant:"h6",fontWeight:700,children:K.length}),e.jsx(i,{variant:"body2",children:"Orders"})]})]})})]}),e.jsxs(c,{sx:{mb:4},children:[e.jsxs(i,{variant:"h4",component:"h1",gutterBottom:!0,children:[a("dashboard.welcome")," ",f.name,"!"]}),e.jsxs(i,{variant:"subtitle1",color:"textSecondary",children:[f.role.charAt(0).toUpperCase()+f.role.slice(1)," ",a("dashboard.dashboard")]})]}),f.role==="farmer"&&Je(),f.role==="vendor"&&ke(),f.role==="user"&&Y(),e.jsxs(ee,{open:ge,onClose:()=>Q(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(re,{children:a("dashboard.addNewProduct")}),e.jsx(te,{children:e.jsx(c,{component:"form",sx:{mt:2},children:e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:a("dashboard.productName"),fullWidth:!0,required:!0,value:l.name,onChange:s=>k({...l,name:s.target.value})})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,required:!0,children:[e.jsx(Fe,{children:a("dashboard.category")}),e.jsxs(ze,{label:a("dashboard.category"),value:l.category,onChange:s=>k({...l,category:s.target.value}),children:[e.jsx(_,{value:"vegetables",children:a("dashboard.vegetables")}),e.jsx(_,{value:"fruits",children:a("dashboard.fruits")}),e.jsx(_,{value:"grains",children:a("dashboard.grains")}),e.jsx(_,{value:"dairy",children:a("dashboard.dairy")}),e.jsx(_,{value:"meat",children:a("dashboard.meat")}),e.jsx(_,{value:"poultry",children:a("dashboard.poultry")}),e.jsx(_,{value:"other",children:a("dashboard.other")})]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:a("dashboard.price"),type:"number",fullWidth:!0,required:!0,value:l.price,onChange:s=>k({...l,price:s.target.value})})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,required:!0,children:[e.jsx(Fe,{children:a("dashboard.unit")}),e.jsxs(ze,{label:a("dashboard.unit"),value:l.unit,onChange:s=>k({...l,unit:s.target.value}),children:[e.jsx(_,{value:"kg",children:a("dashboard.kilogram")}),e.jsx(_,{value:"g",children:a("dashboard.gram")}),e.jsx(_,{value:"lb",children:a("dashboard.pound")}),e.jsx(_,{value:"piece",children:a("dashboard.piece")}),e.jsx(_,{value:"dozen",children:a("dashboard.dozen")}),e.jsx(_,{value:"bunch",children:a("dashboard.bunch")})]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:a("dashboard.availableQuantity"),type:"number",fullWidth:!0,required:!0,value:l.availableQuantity,onChange:s=>k({...l,availableQuantity:s.target.value})})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:a("dashboard.harvestDate"),type:"date",fullWidth:!0,required:!0,value:l.harvestDate,onChange:s=>k({...l,harvestDate:s.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(S,{label:a("dashboard.description"),multiline:!0,rows:4,fullWidth:!0,required:!0,value:l.description,onChange:s=>k({...l,description:s.target.value})})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{label:a("dashboard.district"),fullWidth:!0,required:!0,value:l.location.district,onChange:s=>k({...l,location:{...l.location,district:s.target.value}})})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,required:!0,children:[e.jsx(Fe,{id:"state-select-label",children:a("dashboard.state")}),e.jsx(ze,{labelId:"state-select-label",id:"state-select",value:l.location.state,label:a("dashboard.state"),onChange:s=>k({...l,location:{...l.location,state:s.target.value}}),children:["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal"].map(s=>e.jsx(_,{value:s,children:s},s))})]})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(Jr,{control:e.jsx(Kr,{checked:l.isOrganic,onChange:s=>k({...l,isOrganic:s.target.checked}),color:"secondary"}),label:a("dashboard.organicProduct")})}),e.jsxs(h,{item:!0,xs:12,children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:a("dashboard.productImages")}),e.jsx(vt,{images:l.images,onImagesChange:s=>k({...l,images:s}),uploading:se})]})]})})}),e.jsxs(ae,{children:[e.jsx(m,{onClick:()=>Q(!1),children:a("dashboard.cancel")}),e.jsx(m,{variant:"contained",color:"primary",onClick:oe,children:a("dashboard.addProduct")})]})]})]})},Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Bt},Symbol.toStringTag,{value:"Module"}));function br(r){const{children:n,value:o,index:x,...a}=r;return e.jsx("div",{role:"tabpanel",hidden:o!==x,id:`profile-tabpanel-${x}`,"aria-labelledby":`profile-tab-${x}`,...a,children:o===x&&e.jsx(c,{sx:{py:3},children:n})})}function Fr(r){switch(r){case"farmer":return"/images/farmerProfilePlaceholder.png";case"vendor":return"/images/vendorProfilePlaceholder.png";default:return"/images/userProfilePlaceholder.png"}}function Ht(r){return new Promise((n,o)=>{const x=new FileReader;x.onload=()=>n(x.result.split(",")[1]),x.onerror=o,x.readAsDataURL(r)})}const Vt=({user:r,onImageSelected:n,loading:o,preview:x,setProfileImagePreview:a})=>{const P=d.useRef(null),E=()=>x||(r!=null&&r.profileImage&&r.profileImage.data&&r.profileImage.contentType?`data:${r.profileImage.contentType};base64,${r.profileImage.data}`:Fr(r==null?void 0:r.role)),T=D=>{var A;(D.key==="Enter"||D.key===" ")&&((A=P.current)==null||A.click())};return e.jsxs(c,{sx:{position:"relative",mb:1},children:[e.jsx(Se,{src:E(),alt:(r==null?void 0:r.name)||"Profile",sx:{width:100,height:100,border:D=>`3px solid ${D.palette.primary.main}`,bgcolor:"#f0f0f0"},imgProps:{loading:"lazy",style:{objectFit:"cover"}}}),e.jsx(at,{title:"Change profile photo",children:e.jsx(Pe,{"aria-label":"Change profile photo",size:"small",sx:{position:"absolute",bottom:4,right:4,background:"#fff",borderRadius:"50%",boxShadow:1,p:.5,zIndex:2,"&:hover":{background:"#f5f5f5"}},onClick:()=>{var D;return(D=P.current)==null?void 0:D.click()},onKeyDown:T,tabIndex:0,children:e.jsx(Pr,{fontSize:"small",color:"primary"})})}),e.jsx("input",{type:"file",accept:"image/*",ref:P,style:{display:"none"},onChange:D=>{var W;const A=((W=D.target.files)==null?void 0:W[0])||null;if(n(A),A){const R=new FileReader;R.onload=()=>a(R.result),R.readAsDataURL(A)}else a(null)},tabIndex:-1}),o&&e.jsx(V,{size:32,sx:{position:"absolute",top:34,left:34,zIndex:3}})]})},Jt=()=>{var ar;yr();const[r,n]=d.useState(null),[o,x]=d.useState(!0),[a,P]=d.useState(0),[E,T]=d.useState(!1),[D,A]=d.useState(!1),[W,R]=d.useState([]),[B,se]=d.useState({sent:[],received:[]}),[He,K]=d.useState(!1),[we,f]=d.useState(!1),[ne,ie]=d.useState(null),[F,q]=d.useState({name:"",email:"",phone:"",address:{street:"",district:"",state:"",zipcode:""}}),[Ie,ge]=d.useState(!1),[Q,l]=d.useState(null),[k,oe]=d.useState(null),[Ve,Je]=d.useState([]),[ke,Y]=d.useState(!1),[be,H]=d.useState(!1),[s,v]=d.useState(null),[C,w]=d.useState(1),[y,ye]=d.useState(""),[Ke,zr]=d.useState(""),[De,Ye]=d.useState(!0),[Ge,Tr]=d.useState(""),[Re,Xe]=d.useState(!0),[Ze,er]=d.useState(null),[rr,tr]=d.useState(null),G=vr(),{t:u}=Cr();d.useEffect(()=>{if(!localStorage.getItem("token")){G("/login");return}const j=()=>{if(!localStorage.getItem("token")){G("/login");return}},z=async()=>{try{const I=await $e();if(n(I),q({name:I.name,email:I.email,phone:I.phone,address:I.address||{street:"",district:"",state:"",zipcode:""}}),I.role==="farmer"){const Ce=await Qe();R(Ce)}const[_e]=await Promise.all([Le()]);se(_e)}catch{}finally{x(!1)}};j(),z()},[G]),d.useEffect(()=>{if((r==null?void 0:r.role)==="farmer"&&a===0){const t=new AbortController;return(async()=>{K(!0);try{const z=await Qe({signal:t.signal});R(I=>JSON.stringify(I)===JSON.stringify(z)?I:z)}finally{K(!1)}})(),()=>t.abort()}},[a]);const Wr=async()=>{try{const t=await $e();n(t),q({name:t.name,email:t.email,phone:t.phone,address:t.address||{street:"",district:"",state:"",zipcode:""}})}catch(t){t.status===401&&(localStorage.removeItem("token"),G("/login")),n(null),console.error("Error fetching profile:",t),g.error(String(t.message||t))}finally{x(!1)}},Nr=(t,j)=>{P(j)},Or=()=>{T(!0)},Er=()=>{A(!0)},ve=async()=>{try{const t=await Le();se(t)}catch{se({sent:[],received:[]})}},qr=t=>{l(t),oe(t?URL.createObjectURL(t):null)},Mr=async t=>{t.preventDefault(),ge(!0);try{if(Q){const j=await Ht(Q);await Ue({...F,profileImage:{data:j,contentType:Q.type}})}else await Ue(F);await Wr(),T(!1),l(null),oe(null),g.success(u("profile.profileUpdated"))}catch(j){console.error("Update error:",j),j.details?Object.values(j.details).forEach(z=>{g.error(String(z))}):g.error(String(j.message||u("profile.failedToUpdateProfile")))}finally{ge(!1)}},Lr=t=>{ie(t),f(!0)},$r=async()=>{if(ne)try{await Dr(ne),R(t=>t.filter(j=>j._id!==ne)),g.success(u("profile.productDeleted"))}catch(t){console.error("Delete product error:",t),g.error(String(t))}finally{f(!1),ie(null)}},Ur=async()=>{try{await Ir(),g.success(u("profile.accountDeleted")),G("/login")}catch(t){g.error(String(t.message||t))}},Qr=t=>{switch(t){case"farmer":return u("profile.farmer");case"vendor":return u("profile.vendor");case"user":default:return u("profile.customer")}},X=t=>{const{name:j,value:z}=t.target;if(j.includes(".")){const[I,_e]=j.split(".");q(Ce=>({...Ce,[I]:{...Ce[I],[_e]:z}}))}else q(I=>({...I,[j]:z}))},Br=async()=>{if(!s||y===""||isNaN(Number(y))||Number(y)<=0){g.error("Please enter a valid final price.");return}try{await _r(s._id,{finalQuantity:C,finalPrice:Number(y),didBuy:De,feedback:Ke}),g.success("Confirmation submitted!"),Y(!1),ve()}catch{g.error("Failed to submit confirmation")}},Hr=async()=>{if(!s||y===""||isNaN(Number(y))||Number(y)<=0){g.error("Please enter a valid final price.");return}try{await Ar(s._id,{finalQuantity:C,finalPrice:Number(y),didSell:Re,feedback:Ge}),g.success("Confirmation submitted!"),H(!1),ve()}catch{g.error("Failed to submit confirmation")}};return o?e.jsx(J,{sx:{py:8,textAlign:"center"},children:e.jsx(V,{})}):r?e.jsxs(e.Fragment,{children:[e.jsxs(J,{maxWidth:"lg",sx:{py:8},children:[e.jsxs(N,{sx:{p:3,mb:4},children:[e.jsxs(c,{sx:{display:"flex",alignItems:{xs:"flex-start",sm:"center"},flexDirection:{xs:"column",sm:"row"},mb:3,gap:{xs:2,sm:3}},children:[e.jsx(Se,{src:k||(r!=null&&r.profileImage&&r.profileImage.data&&r.profileImage.contentType?`data:${r.profileImage.contentType};base64,${r.profileImage.data}`:Fr(r==null?void 0:r.role)),alt:(r==null?void 0:r.name)||"Profile",sx:{width:100,height:100,border:t=>`3px solid ${t.palette.primary.main}`,bgcolor:"#f0f0f0"},imgProps:{loading:"lazy",style:{objectFit:"cover"}}}),e.jsxs(c,{children:[e.jsx(i,{variant:"h4",sx:{typography:{xs:"h5",sm:"h4"},wordBreak:"break-word",textAlign:{xs:"center",sm:"left"},overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",mb:0,lineHeight:1.2,pt:.5},children:r.name}),e.jsxs(c,{children:[e.jsx(i,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:Qr(r.role)}),r.username&&e.jsxs(i,{variant:"body2",color:"text.primary",sx:{fontWeight:500},gutterBottom:!0,children:["@",r.username]}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[u("profile.memberSince")," ",new Date(r.createdAt).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs(c,{sx:{width:{xs:"100%",sm:"auto"},display:"flex",gap:2,flexDirection:{xs:"row",sm:"row"},justifyContent:{xs:"space-between",sm:"flex-start"},mt:{xs:2,sm:0}},children:[e.jsx(m,{variant:"outlined",startIcon:e.jsx(Pr,{}),onClick:Or,size:"small",sx:{whiteSpace:"nowrap",minWidth:"40px",px:{xs:1,sm:2},"& .MuiButton-startIcon":{mr:{xs:0,sm:1},marginLeft:0}},children:e.jsx(c,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:u("profile.editProfile")})}),e.jsx(m,{variant:"outlined",color:"error",startIcon:e.jsx(or,{}),onClick:Er,size:"small",sx:{whiteSpace:"nowrap",minWidth:"40px",px:{xs:1,sm:2},"& .MuiButton-startIcon":{mr:{xs:0,sm:1},marginLeft:0}},children:e.jsx(c,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:u("profile.deleteAccount")})})]})]})]}),e.jsxs(c,{children:[e.jsx(sr,{sx:{my:2}}),e.jsxs(c,{children:[e.jsx(sr,{sx:{my:2}}),e.jsxs(et,{children:[e.jsxs(Ee,{children:[e.jsx(st,{color:"primary",sx:{mr:2}}),e.jsx(qe,{primary:u("profile.email"),secondary:r.email})]}),e.jsxs(Ee,{children:[e.jsx(nt,{color:"primary",sx:{mr:2}}),e.jsx(qe,{primary:u("profile.phone"),secondary:r.phone})]}),e.jsxs(Ee,{children:[e.jsx(it,{color:"primary",sx:{mr:2}}),e.jsx(qe,{primary:u("profile.address"),secondary:(ar=r.address)!=null&&ar.street?`${r.address.street}, ${r.address.district}, ${r.address.state}, ${r.address.zipcode}`:u("profile.addressNotProvided")})]})]})]})]})]}),e.jsxs(N,{sx:{p:3},children:[e.jsxs(rt,{value:a,onChange:Nr,"aria-label":"profile tabs",variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{mb:3},children:[(r==null?void 0:r.role)==="farmer"&&e.jsx(nr,{label:u("profile.productsTab")}),e.jsx(nr,{label:u("profile.contactRequestsTab")})]}),(r==null?void 0:r.role)==="farmer"&&a===0&&e.jsx(br,{value:a,index:0,children:He?e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsx(V,{})}):W.length===0?e.jsx(i,{variant:"body1",color:"text.secondary",children:u("profile.noProductsUploaded")}):e.jsx(h,{container:!0,spacing:2,children:W.map(t=>e.jsx(h,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(N,{elevation:2,sx:{p:2},children:[e.jsx(i,{variant:"h6",children:t.name}),e.jsx(i,{variant:"body2",color:"text.secondary",children:t.category??"N/A"}),e.jsxs(i,{variant:"body2",children:["Price: ",t.price," / ",t.unit]}),e.jsxs(i,{variant:"body2",children:["Available: ",t.availableQuantity]}),t.images&&t.images.length>0&&e.jsx(tt,{component:"img",height:"120",image:t.images[0],alt:t.name,sx:{mt:1,mb:1,objectFit:"cover",borderRadius:1}}),e.jsxs(c,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[e.jsx(m,{variant:"outlined",size:"small",onClick:()=>G(`/products/${t._id}`),children:u("profile.viewDetails")}),e.jsx(m,{variant:"contained",color:"error",size:"small",startIcon:e.jsx(or,{}),onClick:()=>Lr(t._id),children:u("profile.delete")})]})]})},t._id))})}),a===((r==null?void 0:r.role)==="farmer"?1:0)&&e.jsxs(br,{value:a,index:(r==null?void 0:r.role)==="farmer"?1:0,children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:u("profile.contactRequestsTab")}),e.jsxs(c,{children:[e.jsx(i,{variant:"subtitle1",children:"Sent Requests"}),B.sent.length===0?e.jsx(i,{children:"No sent requests."}):B.sent.map(t=>{var j;return e.jsxs(c,{sx:{mb:2,p:2,border:"1px solid #eee",borderRadius:2},children:[e.jsxs(i,{children:["Product: ",((j=t.productId)==null?void 0:j.name)||t.productId]}),e.jsxs(i,{children:["Status: ",t.status]}),e.jsxs(i,{children:["Requested At: ",new Date(t.requestedAt).toLocaleString()]}),typeof t.requestedQuantity<"u"&&e.jsxs(i,{children:["Requested Quantity: ",t.requestedQuantity]}),(t.status==="accepted"||t.status==="completed"||t.status==="disputed"||t.status==="not_completed"||t.status==="expired")&&t.farmerId&&e.jsxs(c,{sx:{mt:1,mb:1,p:1,bgcolor:"#f9f9f9",borderRadius:1},children:[e.jsx(i,{variant:"subtitle2",children:"Farmer Contact Info:"}),t.farmerId.phone&&e.jsxs(i,{children:["Phone: ",t.farmerId.phone]}),t.farmerId.email&&e.jsxs(i,{children:["Email: ",t.farmerId.email]}),t.farmerId.address&&e.jsxs(i,{children:["Address: ",t.farmerId.address.street,", ",t.farmerId.address.district,", ",t.farmerId.address.state,", ",t.farmerId.address.zipcode]})]}),t.status==="accepted"&&!t.userConfirmed&&e.jsx(m,{variant:"contained",color:"primary",size:"small",sx:{mt:1},onClick:()=>{v(t),w(t.requestedQuantity||1),ye(""),Y(!0)},children:"Did you buy this product?"}),t.status==="completed"&&e.jsx(i,{color:"success.main",children:"Completed"}),t.status==="disputed"&&e.jsx(i,{color:"error.main",children:"Disputed"}),t.finalQuantity&&e.jsxs(i,{children:["Final Quantity: ",t.finalQuantity]}),t.finalPrice&&e.jsxs(i,{children:["Final Price: ",t.finalPrice]}),t.userFeedback&&e.jsxs(i,{children:["User Feedback: ",t.userFeedback]}),t.farmerFeedback&&e.jsxs(i,{children:["Farmer Feedback: ",t.farmerFeedback]}),t.adminNote&&e.jsxs(i,{children:["Admin Note: ",t.adminNote]})]},t._id)}),(r==null?void 0:r.role)!=="user"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"subtitle1",sx:{mt:2},children:"Received Requests"}),B.received.length===0?e.jsx(i,{children:"No received requests."}):B.received.map(t=>{var j,z;return e.jsxs(c,{sx:{mb:2,p:2,border:"1px solid #eee",borderRadius:2},children:[e.jsxs(i,{children:["From: ",((j=t.requesterId)==null?void 0:j.name)||t.requesterId]}),e.jsxs(i,{children:["Product: ",((z=t.productId)==null?void 0:z.name)||t.productId]}),e.jsxs(i,{children:["Status: ",t.status]}),e.jsxs(i,{children:["Requested At: ",new Date(t.requestedAt).toLocaleString()]}),typeof t.requestedQuantity<"u"&&e.jsxs(i,{children:["Requested Quantity: ",t.requestedQuantity]}),t.status==="pending"&&e.jsxs(c,{sx:{mt:1,display:"flex",gap:1},children:[e.jsx(m,{variant:"contained",color:"success",size:"small",disabled:Ze===t._id,onClick:async()=>{er(t._id);try{await Sr(t._id),g.success("Request accepted"),ve()}catch{g.error("Failed to accept request")}finally{er(null)}},children:Ze===t._id?e.jsx(V,{size:18}):"Accept"}),e.jsx(m,{variant:"outlined",color:"error",size:"small",disabled:rr===t._id,onClick:async()=>{tr(t._id);try{await wr(t._id),g.info("Request rejected"),ve()}catch{g.error("Failed to reject request")}finally{tr(null)}},children:rr===t._id?e.jsx(V,{size:18}):"Reject"})]}),t.status==="accepted"&&t.userConfirmed&&!t.farmerConfirmed&&e.jsx(m,{variant:"contained",color:"primary",size:"small",sx:{mt:1},onClick:()=>{v(t),w(t.finalQuantity||1),ye(""),H(!0)},children:"Confirm Sale"}),t.finalQuantity&&e.jsxs(i,{children:["Final Quantity: ",t.finalQuantity]}),t.finalPrice&&e.jsxs(i,{children:["Final Price: ",t.finalPrice]}),t.userFeedback&&e.jsxs(i,{children:["User Feedback: ",t.userFeedback]}),t.farmerFeedback&&e.jsxs(i,{children:["Farmer Feedback: ",t.farmerFeedback]}),t.adminNote&&e.jsxs(i,{children:["Admin Note: ",t.adminNote]})]},t._id)})]})]}),e.jsxs(ee,{open:ke,onClose:()=>Y(!1),children:[e.jsx(re,{children:"Confirm Purchase"}),e.jsxs(te,{children:[e.jsx(S,{label:"Final Bought Quantity",type:"number",value:C,onChange:t=>w(Number(t.target.value)),fullWidth:!0,sx:{mt:2}}),e.jsx(S,{label:"Final Price",type:"number",value:y,onChange:t=>ye(t.target.value),fullWidth:!0,sx:{mt:2},required:!0,error:y===""||isNaN(Number(y))||Number(y)<=0,helperText:y===""?"Final price is required":isNaN(Number(y))||Number(y)<=0?"Enter a valid price":""}),e.jsx(S,{label:"Feedback (optional)",value:Ke,onChange:t=>zr(t.target.value),fullWidth:!0,sx:{mt:2}}),e.jsxs(c,{sx:{mt:2},children:[e.jsx(m,{variant:De?"contained":"outlined",color:"success",onClick:()=>Ye(!0),sx:{mr:1},children:"Yes, I bought"}),e.jsx(m,{variant:De?"outlined":"contained",color:"error",onClick:()=>Ye(!1),children:"No, I did not buy"})]})]}),e.jsxs(ae,{children:[e.jsx(m,{onClick:()=>Y(!1),children:"Cancel"}),e.jsx(m,{onClick:Br,color:"primary",children:"Submit"})]})]}),e.jsxs(ee,{open:be,onClose:()=>H(!1),children:[e.jsx(re,{children:"Confirm Sale"}),e.jsxs(te,{children:[e.jsx(S,{label:"Final Sold Quantity",type:"number",value:C,onChange:t=>w(Number(t.target.value)),fullWidth:!0,sx:{mt:2}}),e.jsx(S,{label:"Final Price",type:"number",value:y,onChange:t=>ye(t.target.value),fullWidth:!0,sx:{mt:2},required:!0,error:y===""||isNaN(Number(y))||Number(y)<=0,helperText:y===""?"Final price is required":isNaN(Number(y))||Number(y)<=0?"Enter a valid price":""}),e.jsx(S,{label:"Feedback (optional)",value:Ge,onChange:t=>Tr(t.target.value),fullWidth:!0,sx:{mt:2}}),e.jsxs(c,{sx:{mt:2},children:[e.jsx(m,{variant:Re?"contained":"outlined",color:"success",onClick:()=>Xe(!0),sx:{mr:1},children:"Yes, I sold"}),e.jsx(m,{variant:Re?"outlined":"contained",color:"error",onClick:()=>Xe(!1),children:"No, I did not sell"})]})]}),e.jsxs(ae,{children:[e.jsx(m,{onClick:()=>H(!1),children:"Cancel"}),e.jsx(m,{onClick:Hr,color:"primary",children:"Submit"})]})]})]})]})]}),e.jsxs(ee,{open:E,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:u("profile.editProfile")}),e.jsxs("form",{onSubmit:Mr,children:[e.jsxs(te,{children:[e.jsx(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mt:1,mb:2},children:e.jsx(Vt,{user:r,onImageSelected:qr,loading:Ie,preview:k,setProfileImagePreview:oe})}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:u("profile.name"),name:"name",value:F.name,onChange:X,required:!0})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:u("profile.email"),name:"email",type:"email",value:F.email,disabled:!0,required:!0,sx:{"& .MuiInputBase-input":{cursor:"not-allowed",color:"text.disabled"}}})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:u("profile.phone"),name:"phone",value:F.phone,onChange:X,required:!0})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:u("profile.street"),name:"address.street",value:F.address.street,onChange:X,required:!0})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{fullWidth:!0,label:u("profile.district"),name:"address.district",value:F.address.district,onChange:X,required:!0})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{fullWidth:!0,label:u("profile.state"),name:"address.state",value:F.address.state,onChange:X,required:!0})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:u("profile.zipCode"),name:"address.zipcode",value:F.address.zipcode,onChange:X,required:!0})})]})]}),e.jsxs(ae,{children:[e.jsx(m,{onClick:()=>T(!1),children:u("profile.cancel")}),e.jsx(m,{type:"submit",variant:"contained",children:u("profile.saveChanges")})]})]})]}),e.jsxs(ee,{open:D,onClose:()=>A(!1),children:[e.jsx(re,{children:u("profile.deleteAccount")}),e.jsx(te,{children:e.jsx(i,{children:u("profile.deleteAccountConfirm")})}),e.jsxs(ae,{children:[e.jsx(m,{onClick:()=>A(!1),children:u("profile.cancel")}),e.jsx(m,{onClick:Ur,color:"error",variant:"contained",children:u("profile.deleteAccount")})]})]}),e.jsxs(ee,{open:we,onClose:()=>f(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:u("profile.confirmProductDeletion")}),e.jsx(te,{children:e.jsx(i,{variant:"body1",children:u("profile.confirmProductDeletionText")})}),e.jsxs(ae,{children:[e.jsx(m,{onClick:()=>f(!1),color:"primary",variant:"outlined",children:u("profile.cancel")}),e.jsx(m,{onClick:$r,color:"error",variant:"contained",children:u("profile.confirmDelete")})]})]})]}):e.jsx(J,{sx:{py:8,textAlign:"center"},children:e.jsx(Me,{severity:"error",children:u("profile.failedToLoadProfile")})})},Zt=Object.freeze(Object.defineProperty({__proto__:null,default:Jt},Symbol.toStringTag,{value:"Module"}));export{Xt as D,vt as I,Zt as P,ht as a,lt as b,ot as c,_r as d,Ar as e,ut as f,xt as g,mt as h,pt as i,ft as j,jt as k,Gt as l};
//# sourceMappingURL=dashboard-D54Ge2h1.js.map
